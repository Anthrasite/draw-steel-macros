{ "_id": "hi1QF7EwgHD3eLVn", "name": "Draw steel", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/skills/movement/figure-running-gray.webp", "command": "//@id=hi1QF7EwgHD3eLVn\n//@name=Draw steel\n//@img=icons/skills/movement/figure-running-gray.webp\nAudioHelper.play({src: \"modules/draw-steel-playtest-macros/audio/sword-drawing.mp3\", volume: 1, autoplay: true, loop: false}, true);\n\nconst roll = await new Roll(`1d10`).evaluate();\nconst heroesActFirst = roll.total >= 6;\nawait game.macros.getName(`ShareRoll`).execute({\n  activeActor: actor,\n  roll,\n  flavor: `<span style=\"color: ${heroesActFirst ? `#008000` : `#800000`};\">${heroesActFirst ? `Heroes` : `Foes`} strike first!</span>`\n});" }
{ "_id": "VuzLJPa7S52xeU9X", "name": "End combat", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/skills/melee/blade-tip-chipped-blood-red.webp", "command": "//@id=VuzLJPa7S52xeU9X\n//@name=End combat\n//@img=icons/skills/melee/blade-tip-chipped-blood-red.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const gainedVictories = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: `Victories`, label: `Victories earned`, defaultValue: 1, allowNegative: false }));\n  if (gainedVictories > 0)\n    await game.macros.getName(\"UpdateAttribute\").execute({ activeActor, attributeName: \"victories\", value: gainedVictories, isDelta: true });\n\n  await game.macros.getName(\"UpdateAttribute\").execute({ activeActor, attributeName: \"surges\", value: 0 });\n  await game.macros.getName(\"UpdateAttribute\").execute({ activeActor, attributeName: \"resource\", value: 0 });\n  await game.macros.getName(\"UpdatePersistentCost\").execute({ activeActor });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "4ldruWznMIR26JA5", "name": "End persistent effect", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/magic/light/hand-sparks-smoke-teal.webp", "command": "//@id=4ldruWznMIR26JA5\n//@name=End persistent effect\n//@img=icons/magic/light/hand-sparks-smoke-teal.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const resourceLabel = (await game.macros.getName(`GetAttribute`).execute({ activeActor, attributeName: `resource` })).label;\n  const selectedAbilities = await game.macros.getName(\"ShowPersistentCostDialog\").execute({ activeActor, label: `Persistent effects to end`, resourceLabel });\n  if (!selectedAbilities)\n    ui.notifications.info(`No active persistent effects!`);\n  else\n    for (const abilityName of selectedAbilities)\n      await game.macros.getName(`UpdatePersistentCost`).execute({ activeActor, abilityName });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "C9Rq36QntKBJ78Uf", "name": "Gain resource", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/magic/symbols/ring-circle-smoke-blue.webp", "command": "//@id=C9Rq36QntKBJ78Uf\n//@name=Gain resource\n//@img=icons/magic/symbols/ring-circle-smoke-blue.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const resource = await game.macros.getName(`GetAttribute`).execute({ activeActor, attributeName: `resource` });\n  const resourceLabel = resource.label.capitalize();\n  const resourceGain = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: resourceLabel, label: `${resourceLabel} gained`, defaultValue: 1, allowNegative: false }));\n\n  if (resourceGain > 0)\n    await game.macros.getName(`UpdateAttribute`).execute({ activeActor, attributeName: `resource`, value: resourceGain, isDelta: true });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "2goha35ftCeBsPiS", "name": "Gain surges", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/magic/sonic/explosion-shock-wave-teal.webp", "command": "//@id=2goha35ftCeBsPiS\n//@name=Gain surges\n//@img=icons/magic/sonic/explosion-shock-wave-teal.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const surgesGained = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: `Surges`, label: `Surges gained`, defaultValue: 1, allowNegative: false }));\n\n  if (surgesGained > 0)\n    await game.macros.getName(`UpdateAttribute`).execute({ activeActor, attributeName: `surges`, value: surgesGained, isDelta: true });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "hmxXiT9slLJFPp4w", "name": "Gain temporary stamina", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/magic/defensive/shield-barrier-glowing-blue.webp", "command": "//@id=hmxXiT9slLJFPp4w\n//@name=Gain temporary stamina\n//@img=icons/magic/defensive/shield-barrier-glowing-blue.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const tempStaminaGained = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: `Temporary stamina`, label: `Temporary stamina gained`, allowNegative: false }));\n\n  if (tempStaminaGained > 0)\n    await game.macros.getName(`UpdateTempStamina`).execute({ activeActor, value: tempStaminaGained });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "jte0ZyibHwRUDQsM", "name": "Gain victories", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/commodities/treasure/cup-trophy-gold.webp", "command": "//@id=jte0ZyibHwRUDQsM\n//@name=Gain victories\n//@img=icons/commodities/treasure/cup-trophy-gold.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const victoriesGained = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ title: `Victories`, label: `Victories gained`, defaultValue: 1, allowNegative: false }));\n\n  if (victoriesGained > 0)\n    await game.macros.getName(`UpdateAttribute`).execute({ activeActor, attributeName: `victories`, value: victoriesGained, isDelta: true });\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "zawCdUf340GQMJDK", "name": "Start combat", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/skills/melee/hand-grip-sword-orange.webp", "command": "//@id=zawCdUf340GQMJDK\n//@name=Start combat\n//@img=icons/skills/melee/hand-grip-sword-orange.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const victories = (await game.macros.getName(`GetAttribute`).execute({ activeActor, attributeName: `victories` })).value;\n\n  const resource = await game.macros.getName(`UpdateAttribute`).execute({ activeActor, attributeName: `resource`, value: victories });\n\n  const roll = await new Roll(`${victories}[victories]`).evaluate();\n  await game.macros.getName(`ShareRoll`).execute({\n    activeActor,\n    roll,\n    flavor: `Initial ${resource.label}`\n  });\n}\ncatch (error) {\n  ui.notifications.error(error);\n}" }
{ "_id": "Lh7ZOYjE2msPSG6U", "name": "Take damage", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/skills/wounds/injury-triple-slash-bleed.webp", "command": "//@id=Lh7ZOYjE2msPSG6U\n//@name=Take damage\n//@img=icons/skills/wounds/injury-triple-slash-bleed.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const damageTaken = Number(await game.macros.getName(`ShowSimpleInputDialog`).execute({ label: `Damage taken`, allowNegative: false }));\n\n  if (damageTaken > 0) {\n    let remainingDamage = damageTaken;\n\n    const tempStamina = (await game.macros.getName(`GetAttribute`).execute({ activeActor, attributeName: `tempStamina` })).value;\n    if (tempStamina > 0) {\n      remainingDamage = tempStamina > damageTaken ? 0 : remainingDamage - tempStamina;\n\n      const tempStaminaLost = tempStamina > damageTaken ? damageTaken : tempStamina;\n      await game.macros.getName(`UpdateAttribute`).execute({ activeActor, attributeName: `tempStamina`, value: -tempStaminaLost, isDelta: true });\n    }\n\n    if (remainingDamage > 0)\n      await game.macros.getName(`UpdateAttribute`).execute({ activeActor, attributeName: `stamina`, value: -remainingDamage, isDelta: true });\n  }\n}\ncatch (error) {\n  if (error.message !== \"The Dialog was closed without a choice being made.\")\n    ui.notifications.error(error);\n}" }
{ "_id": "fHT9Y1QkwMhazr7D", "name": "Use recovery", "scope": "global", "type": "script", "ownership": { "default": 0 }, "img": "icons/magic/life/cross-worn-green.webp", "command": "//@id=fHT9Y1QkwMhazr7D\n//@name=Use recovery\n//@img=icons/magic/life/cross-worn-green.webp\ntry {\n  const activeActor = actor;\n  await game.macros.getName(\"ValidateActorAttributes\").execute({ activeActor });\n\n  const stamina = (await game.macros.getName(`GetAttribute`).execute({ activeActor, attributeName: `stamina` }));\n\n  if (stamina.value >= stamina.max)\n    ui.notifications.info(`Stamina is already full!`);\n  else {\n    const recoveries = (await game.macros.getName(`GetAttribute`).execute({ activeActor, attributeName: `recoveries` }));\n\n    if (recoveries.value <= 0)\n      ui.notifications.info(`No recoveries left!`);\n    else {\n      const recoveryValue = Math.floor(stamina.max / 3);\n      const newStamina = Math.min(stamina.value + recoveryValue, stamina.max);\n\n      if (newStamina < stamina.value + recoveryValue) {\n        const useRecovery = await Dialog.confirm({\n          title: `Use recovery?`,\n          content: `<p>Warning: If you use a Recovery, ${stamina.value + recoveryValue - newStamina} Stamina will be wasted. Do you still want to use a Recovery?</p>`,\n          defaultYes: false\n        });\n        if (!useRecovery)\n          return;\n      }\n\n      await game.macros.getName(`UpdateAttribute`).execute({ activeActor, attributeName: `stamina`, value: newStamina });\n      await game.macros.getName(`UpdateAttribute`).execute({ activeActor, attributeName: `recoveries`, value: -1, isDelta: true });\n    }\n  }\n}\ncatch (error) {\n  ui.notifications.error(error);\n}" }
